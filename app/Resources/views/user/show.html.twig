{% extends 'base.html.twig' %}

{% block body %}
    <div class="container">
        <div class="row">
            <h1>
                {% if user.fullName %}
                    {{ user.fullName }}'s dashboard
                {% else %}
                    {{ user.email }}'s dashboard
                {% endif %}
                {% if (is_granted('ROLE_ADMIN')) or (app.user.id == user.id) %}
                <a href="{{ path('user_edit', {
                    id: user.id
                }) }}" class="pull-right btn btn-link">
                    <span class="fa fa-edit"></span>
                </a>
                {% endif %}
            </h1>
            <ul class="nav nav-tabs" id="main-tabs">
                <li class="active"><a data-toggle="tab" href="#user-info">My account</a></li>
                <li><a data-toggle="tab" href="#my-environment">My environment</a></li>
                <li><a data-toggle="tab" href="#my-projects">My projects</a></li>
                <li><a data-toggle="tab" href="#my-current-namespaces">My current namespaces</a></li>
            </ul>
            <div class="tab-content">
                <div id="user-info" class="tab-pane fade in active">
                    <h3>My personal information</h3>
                    <table class="table">
                        <tbody>
                        <tr>
                            <th>Name</th>
                            <td>{{ user.fullName|default('-') }}</td>
                        </tr>
                        <tr>
                            <th>Email</th>
                            <td>{{ user.email }}</td>
                        </tr>
                        <tr>
                            <th>Institution</th>
                            <td>{{ user.institution|default('-') }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div id="my-environment" class="tab-pane fade">
                <h3>My environment</h3>

                    <h3>Namespaces of the profiles belonging to the current active project</h3>
                    <ul>
                    {% for namespace in namespacesOfProfilesOfCurrentActiveProject %}
                        <li class="list-unstyled">{{ namespace }}</li>
                    {% endfor %}
                    </ul>
                <h3>Espaces de nom ongoing gérés par le projet</h3>
                <ul>
                {% for namespace in namespacesOfCurrentActiveProject %}
                    {% if not namespace.isTopLevelNamespace %}
                    <li>{{ namespace }}</li>
                    {% endif %}
                {% endfor %}
                </ul>
                <h3>Project namespaces</h3>
                <div class="row">
                    <div class="col-lg-6">
                        <table class="table table-striped" id="project-namespaces-selected-table">
                            <thead>
                            <tr>
                                <th></th>
                                <th>Namespaces URI</th>
                                <th>Namespaces identifier</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for namespace in projectNamespacesSelected if namespace.isOngoing %}
                                <tr>
                                    <td><span class="glyphicon glyphicon-remove text-danger" aria-hidden="true"></span></td>
                                    <td>{{ namespace.namespaceUri }}</td>
                                    <td>
                                        <a href="{{ path('namespace_show', {
                                            'id': namespace.id
                                        }) }}">
                                            {{ namespace }}
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="col-lg-6">
                        <table class="table table-striped" id="project-namespaces-selectable-table">
                            <thead>
                            <tr>
                                <th></th>
                                <th>Namespaces URI</th>
                                <th>Namespaces identifier</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for namespace in projectNamespacesSelectable if not namespace.isOngoing  %}
                                <tr>
                                    <td><span class="fas fa-plus"></span></td>
                                    <td>{{ namespace.namespaceUri }}</td>
                                    <td>
                                        <a href="{{ path('namespace_show', {
                                            'id': namespace.id
                                        }) }}">
                                            {{ namespace }}
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <h3>Additional namespaces</h3>
                    <div class="row">
                        <div class="col-lg-6">
                            <table class="table table-striped" id="additionnal-namespaces-selectable-table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th>Namespaces URI</th>
                                    <th>Namespaces identifier</th>

                                </tr>
                                </thead>
                                <tbody>
                                {% for namespace in additionalNamespacesSelectable %}
                                    <tr>
                                        <td><span class="glyphicon glyphicon-remove text-danger" aria-hidden="true"></span></td>
                                        <td>{{ namespace.namespaceUri }}</td>
                                        <td>
                                            <a href="{{ path('namespace_show', {
                                                'id': namespace.id
                                            }) }}">
                                                {{ namespace }}
                                            </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="col-lg-6">
                            <table class="table table-striped" id="additionnal-namespaces-selected-table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th>Namespaces URI</th>
                                    <th>Namespaces identifier</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for namespace in additionalNamespacesSelected %}
                                    <tr>
                                        <td><span class="fas fa-plus"></span></td>
                                        <td>{{ namespace.namespaceUri }}</td>
                                        <td>
                                            <a href="{{ path('namespace_show', {
                                                'id': namespace.id
                                            }) }}">
                                                {{ namespace }}
                                            </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                </div>
                <div id="my-projects" class="tab-pane fade">
                    <div class="row">
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <h3>My current active project</h3>
                        </div>
                        {{ form_start(myEnvironmentForm, {'attr': {'class' : 'inline-form'}} ) }}
                        <div class="col-lg-12">
                            {{ form_errors(myEnvironmentForm) }}
                            {{ form_row(myEnvironmentForm.currentActiveProject) }}
                            <button type="submit" class="btn btn-primary" formnovalidate>
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                        {{ form_end(myEnvironmentForm) }}
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            {% if namespaces|length < 1 %}
                                <div class="pull-right add-div">
                                    <a href="{{ path('project_new_user')}}"
                                       class="btn btn-primary pull-right">
                                        Add <span class="fa fa-plus-circle"></span>
                                    </a>
                                </div>
                            {% endif %}
                            <h3>My projects</h3>
                            <table class="table table-striped" id="projects-table">
                                <thead>
                                <tr>
                                    <th>Project identifier</th>
                                    <th>Last updated</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for userProjectAssociation in userProjectAssociations %}
                                    <tr>
                                        <td>
                                            <a href="{{ path('project_show', {
                                                'id': userProjectAssociation.project.id
                                            }) }}">
                                                {{ userProjectAssociation.project.standardLabel }}
                                            </a>
                                            {% if userProjectAssociation.project.standardLabel == app.user.currentActiveProject.standardLabel %}
                                                <span class="label label-success">Active</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ userProjectAssociation.project.modificationTime|date('Y-m-d') }}</td>
                                        <td>
                                            {% if userProjectAssociation.project.standardLabel != app.user.currentActiveProject.standardLabel %}
                                            <a href="{{ path('user_edit_current_active_project', {'project': userProjectAssociation.project.id}) }}" class="btn btn-primary">
                                                Active
                                            </a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                            <div class="alert alert-info">
                                <p><i class="fas fa-info-circle"></i>&nbsp;If you are interested in joining an <a href="{{ path('app_project_list') }}" target="_blank">existing project</a>, please write to <a href="mailto:ontome@dataforhistory.org">ontome@dataforhistory.org</a> indicating the name of the <a href="{{ path('app_project_list') }}" target="_blank">project</a> and the reason of your request. </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="my-current-namespaces" class="tab-pane fade">
                    <h3>My current namespaces</h3>
                    <table class="table table-striped" id="namespaces-table">
                        <thead>
                        <tr>
                            <th>Namespaces URI</th>
                            <th>Namespaces identifier</th>
                            <th>Last updated</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for namespace in namespaces %}
                            <tr>
                                <td>{{ namespace.namespaceUri }}</td>
                                <td>
                                    <a href="{{ path('namespace_show', {
                                        'id': namespace.id
                                    }) }}">
                                        {{ namespace }}
                                    </a>
                                </td>
                                <td>{{ namespace.modificationTime|date('Y-m-d') }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $(document).ready(function() {
            $('#namespaces-table').DataTable();
            $('#project-namespaces-selected-table').DataTable();
            $('#project-namespaces-selectable-table').DataTable();
            $('#additionnal-namespaces-selected-table').DataTable();
            $('#additionnal-namespaces-selectable-table').DataTable();
            $('#projects-table').DataTable();
        } );
    </script>
{% endblock %}