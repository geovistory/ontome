{% extends 'base.html.twig' %}

{% block body %}
    <div class="container">
        <div class="row">
            <h1>
                {% if user.fullName %}
                    {{ user.fullName }}'s dashboard
                {% else %}
                    {{ user.email }}'s dashboard
                {% endif %}
                {% if (is_granted('ROLE_ADMIN')) or (app.user.id == user.id) %}
                <a href="{{ path('user_edit', {
                    id: user.id
                }) }}" class="pull-right btn btn-link">
                    <span class="fa fa-edit"></span>
                </a>
                {% endif %}
            </h1>
            <ul class="nav nav-tabs" id="main-tabs">
                <li class="active"><a data-toggle="tab" href="#user-info">My account</a></li>
                <li><a data-toggle="tab" href="#my-projects">My projects</a></li>
                <li><a data-toggle="tab" href="#my-current-namespaces">My current namespaces</a></li>
            </ul>
            <div class="tab-content">
                <div id="user-info" class="tab-pane fade in active">
                    <h3>My personal information</h3>
                    <table class="table">
                        <tbody>
                        <tr>
                            <th>Name</th>
                            <td>{{ user.fullName|default('-') }}</td>
                        </tr>
                        <tr>
                            <th>Email</th>
                            <td>{{ user.email }}</td>
                        </tr>
                        <tr>
                            <th>Institution</th>
                            <td>{{ user.institution|default('-') }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div id="my-projects" class="tab-pane fade">
                    {% if userProjects|length < 1 or userProjects|length == 1 %}
                        <div class="pull-right add-div">
                            <a href="{{ path('project_new_user')}}"
                               class="btn btn-primary pull-right">
                                Add <span class="fa fa-plus-circle"></span>
                            </a>
                        </div>
                    {% endif %}
                    <h3>My projects</h3>
                    <table class="table table-striped" id="projects-table">
                        <thead>
                        <tr>
                            <th>Project name</th>
                            <th>Last updated</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for userProject in userProjects %}
                            <tr>
                                <td>
                                    <a href="{{ path('project_show', {
                                        'id': userProject.project.id
                                    }) }}">
                                        {{ userProject.project.standardLabel }}
                                    </a>
                                    {% if userProject.project.standardLabel == app.user.currentActiveProject.standardLabel %}
                                        <span class="label label-success"><i class="fas fa-dot-circle"></i> Active</span>
                                    {% endif %}
                                </td>
                                <td>{{ userProject.project.modificationTime|date('Y-m-d') }}</td>
                                <td>
                                    {% if userProject.project.standardLabel != app.user.currentActiveProject.standardLabel %}
                                    <a href="{{ path('user_edit_current_active_project', {'project': userProject.project.id}) }}" class="btn btn-xs btn-primary">
                                        <i class="far fa-dot-circle"></i> Activate
                                    </a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <div class="alert alert-info">
                        <p><i class="fas fa-info-circle"></i>&nbsp;If you are interested in joining an <a href="{{ path('app_project_list') }}" target="_blank">existing project</a>, please write to <a href="mailto:ontome@dataforhistory.org">ontome@dataforhistory.org</a> indicating the name of the <a href="{{ path('app_project_list') }}" target="_blank">project</a> and the reason of your request. </p>
                    </div>
                </div>
                <div id="my-current-namespaces" class="tab-pane fade">
                    <h3>Namespaces whose classes and properties are displayed</h3>
                    <div class="row">
                        <div class="col-lg-6">
                            <h4>Managed by the project and additional ones</h4>
                            {{ firstNamespace.standardLabel }}
                            <ul>
                            {% for referencedNamespace in referencedNamespacesForFirstNamespace %}
                                <li>{{ referencedNamespace.standardLabel }}</li>
                            {% endfor %}
                            </ul>
                        </div>
                        <div class="col-lg-6">
                            <h4>Selected from project profiles</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $(document).ready(function() {
            // Onglet My Projects
            $('#projects-table').DataTable({
                "order": [[2, 'asc']]
            });

            // Onglet My current namespaces
        } );
    </script>
{% endblock %}